<?php
// Blocking of bad bots
// COPYRIGHT 2018 GNU/GPL V.2 BY D. MACMATHAN
// Thanks to MickeyRouch for some signature ideas
// FOR USE WITH ZB BLOCK OR ANY GNU/GPL V.2 COMPLIANT DERIVATIVE
// It is not allowed to use this file in whole or part with WEBDEFENSE WEB ALARM or any XYZER Products due to VIOLATIONS OF THE GNU/GPL V.2
// Due to massive domain- and business-hopping it is not allowed to use this file in whole or part with products by Strobel.systems, Quierschied
// THIS FILE IS PROVIDED AS-IS
global $whyblockout, $ax;
$zbbversion .= ' / OBB-2018.17.847';
if(preg_match("%(?i)(?:havij|ips-agent|JFactory|palantir)%",$useragent)) { $ax ++; $whyblockout .= 'Dangerous bot user agent INSTA-BAN (OBB-30001). ';}
if(preg_match("%(?i)(?:a(?:ip|pple)|biru|c(?:ligooro|hitika)|experi|flightdeckreports|p(?:aperli|rinceton|ure)|s(?:afedns|c(?:ooper|reener)|e(?:arch17|mrush|oeng|znam)|howyou|kim|olomono|urdotly|quad)|tob|upicto|w(?:bsearch|ebalt|ise(nut)?))bot%",$useragent)) { $ax ++; $whyblockout .= 'User agent identifying as bot (OBB-30002). ';}
if(preg_match("%(?i)(?: (?:masscan|zgrab)\/|; widows |\.net clr 1\)|\(auto shell spider\)|\r|a(?:\s?href[=s]|boundex|dd catalog|dmantx|l(?:exa|waysonline)|merica online browser|nalyzer|r(?:achmo|chive|tabus)|udit)|b(?:abya discoverer|logpulselive|pimagewalker|ubing)|c(?:l(?:am antivirus|oudflare)|msworldmap|omodo(-certificates-)?spider|ompatible(?: ; msie|-)|ov(?:ario-id|erscout)|python|rawler4j|ydia)|d(?:a(?:tabasedrivermysql|um(?: comm|oa\/|\/))|cs|i(?:scoveryengine|squs)|le_spider|o(?:mainreanimator|tnetdotcom\.org)|ts agent)|e(?:m(?:ail extractor|bedly)|xtraxt)|t\/)|isuna\.com|unwebproducts)|g(?:arlikcrawler|eezer|ithub|luten free crawler|osospider|rub-client|sa-crawler)|h(?:a(ckteam|iloo\.com|nzoweb|rvest|vij)|osttracker|tt(?:pproxy|rack)|uaweisymantecspider)|i(?:carus6j|n(?:dy library|fospider))|j(?:ike|plastiras)\.com|kulturarw3|l(?:a(?:nk slooth|rbin@unspecified)|egalx\.net|i(?:nkdex\.com|pperhey)|tx71|ucidmedia|wp(-trivial)?)|m(?:a(?:cinroy|il\.ru|sscan)|egaindex\.ru|iner|rie8pack|s\s?frontpage|snbot\/(?:1|2\.0)|urzillo compatible)|n(?:e(?:rdbynature\.bot|ttrapport crawler)|ikto|o(?:more404|tconfigured\.com))|offbyone|p(?:agepeeker;|eoplepal|hantomjs|hpinfo\(\)|i(?:csearch|rst;)|o(?:e-component-client|rkbun|strank|wermarks)|rofound\.net|uritysearch)|qwant(?:\.|ify)|r(?:6_|assler|e(?:corded future|search|verseget\.com)|ssmicro\.com)|s(?:ecretsearchenginelabs|ite-shot\/|nappreviewbot|ocial-object-extractor|p(?:amblockerutility|eedy)|uperfeedr)|t(?:elesphore|uring machine|w(?:i(?:(?:celer|sted pagegetter)|tt(?:erfeed|urly))))|u(?:nspecified\.mail|ser-agent\: )|v(?:alueclick|edma\/)|w(?:e(?:b(?:t(?:arantula|humbnail)|washer))|i(?:kiwix|n(?:(?: 9x|128|nt3)|dows (?:3|9[89]|2000|nt(?: [345]| x\.y|;)|xp 5)))|or(?:dpress\/;|io\.com))|xedant human emulator|yabrowser\/)%",$useragent)) { $ax ++; $whyblockout .= 'Known bot user agent (OBB-30003). ';}
if(preg_match("%(?:BOT for JCE|DI7SP2|DOJ3jx7bf)%",$useragent)) { $ax ++; $whyblockout .= 'Dangerous bot user agent INSTA-BAN (OBB-30004). ';}
if(preg_match("%(?:\; Windows (?:NT|XP)\)|\[xUSAx\]|360Spider|80legs|A(?:bonti\/|cunetix|ntivirXP08)|B(?:a(?:iduspider|ndit)|uddy)|Extractor|FHscan|GSLFbot|Re(?:aper|corder)|S(?:iphon|tripper|ucker)|VPNGate|Whacker|Yandex|ZmEu)%",$useragent)) { $ax ++; $whyblockout .= 'Bot user agent (OBB-30005). ';}
if(preg_match("%(?i)(?:(?:fa(?:ng|st|vOrg|xo)|fdse|feed(?:24|hub)|fi(?:lan|le(?:boo|Hound)|map|nd|rs)|fire(?:bat|download\/1\.2pre\ firefox\/3\.6)|fl(?:am|ash|exum|ickBot|icky|ip|uffy|y)|fo(?:oky|rum|rv|st|to|un|xy\/1;)|fr(?:iend|ontpage)|fu(?:ck|er|tile)|fyber)|^(?!.*(?:AppleWebKit\/|Android \d).*).*focus.*$)%",$useragent)) { $ax ++; $whyblockout .= 'The MR botsignature (OBB-30006). ';}
if(preg_match("%^\}__%",$useragent)) { $ax ++; $whyblockout .= 'Joomla hack attempt INSTA-BAN (OBB-30007). ';}
if(preg_match("%^(?i)(?:=|\\'|8484 boston project|a(?:dwords|lexibot|nonym(?:ization|ous)|sterias|tt(?:ach|ributor)|utoemailspider)|b(?:a(?:ckdoorbot|ndit|tchftp)|dfetch|i(?:gfoot|tlybot)|l(?:ackw|o(?:gsearchbot-martin|wfish))|ot(?: mailto:craftbot@yahoo.com|alot)|u(?:iltbottough|llseye|nnyslippers))|c(?:egbfeieh|h(?:e(?:esebot|rrypicker)|inaclaw)|o(?:llector|nte(?:ntsmartz|xtad)|p(?:ier|yrightcheck)|re-project\/|smos)|rescent|usto)|d(?:i(?:amond|g(?:ger|incore)|ibot|sco|ttospyder)|ownload|r(?:agonfly|ip)|umbbot)|e(?:asydl|bingbong|c(?:atch|ollector)|irgrabber|mail(?:\s?siphon|collector)|rocrawler|x(?:press|tractorpro)|yenetie)|f(?:l(?:ashget|unky)|o(?:obot|rum poster)|r(?:anklin|eshdownload|ontpage))|g(?:e(?:omaxenginebot|t(?:right|web!))|o(?:-ahead-got-it|!zilla|rnker|tit)|r(?:a(?:bnet|fula)|ub crawler))|h(?:arvest|eeii|loader|mview|ttpproxy|umanlinks)|i(?:gette|mage|n(?:dy library|ter(?:get|net (?:explorer|ninja)))|sc systems irc|ufw web)|j(?:ava 1\.|e(?:nnybot|tcar)|oc)|k(?:angen|e(?:njin|yword)|mccrew)|l(?:arbin|e(?:ech|xibot)|i(?:bweb\/clshttp|ghtningdownload|nk(?:extractorpro|walker))|wp)|m(?:a(?:c finder|ma c|ss|ta hari)|eta(?:products download express|uri)|i(?:crosoft data access|down|ixpc|ss(?:igua|ouri college browse)|ster)|o(?:get|rfeus|vable type|zilla(?:\s|\/(?:2|4.0(?:\(|\+\(compatible;\+))))|sie|ygetright)|n(?:360\/|a(?:meprotect|v(?:erbot_dloader|road))|e(?:arsite|t(?: vampire|ants|craft|spider|zip))|i(?:cerspro|tro)|pbot|utscrape\/)|o(?:ctopus|ffline|mniexplorer|penmaru)|p(?:a(?:gegrabber|ncient|pa|vuk)|cbrowser|hpcrawl|i(?:cscout|nterest)|lanetwork bot|ro(?:gram shareware|powerbot|webwalker)|s(?:bot\/|ycheclone)|ussycat|y(?:curl|thon-urllib))|r(?:am finder|e(?:aldownload|get|pomonkey|volt)|ma|obofox|ssimagesbot)|s(?:asquia|hareaza|i(?:phon|tesnagger)|l(?:edink|ysearch)|martdownload|n(?:apbot|oopy)|ogou|p(?:ankbot|anner|bot|iderman)|q webscanner|ta(?:mina|r downloader)|u(?:per(?: happy fun|bot|http)|r(?:fbot|veyagent)|zuran)|zukacz)|t(?:akeout|e(?:chrigybot|le(?:port|soft))|he(?: intraformant|nomad)|i(?:ghttwatbot|tan)|jvmultihttpgrabber|ocrawl\/urldispatcher|r(?:ackback|ue_robot)|u(?:ringos|rnitinbot)|w(?:engabot|iceler))|u(?:n(?:der the rainbow|windfetchor)|rly warning|ser|tilmind httpget)|v(?:adixbot|ci|oideye)|w(?:00t|e(?:b(?: (?:downloader|image collector|sucker)|auto|bandit|co(?:llage|pier)|emailextrac|enhancer|fetch|filter|go|leacher|miner|reaper|sauger|site(?: extractor| quester|-x suite)|st(?:er|ripper)|vac|whacker|zip)|lls search|p search)|get|i(?:dow|nnie poh)|ordpress|ww(?:-(?:collector-e|mechanize)|offle))|x(?:aldon|enu)|yebolbot|zeus)%",$useragent)) { $ax ++; $whyblockout .= 'Known bot user agent (OBB-30008). ';}
if(preg_match("%^(?:A(?:IBOT|lexibot)|B(?:ack(?:DoorBot|Web)|lack\.Hole)|Cogentbot|E(?:mailWolf|xabot)|HTTrack|I(?:lseBot|nfo(?:NaviRobot|Tekies)|ntelliseek|ria)|J(?:a(?:karta|va)|ustView|yxobot)|Keyword\.Density|l(?:ftp|ikse)|L(?:inkScan\/|NSpiderguy)|M(?:a(?:g-?Net|rkWatch)|emo|i(?:crosoft.URL|rror)|ozilla(?:.*NEWT|\/3.Mozilla\/2\.01))|N(?:e(?:t(?:craft|Mechanic)|xtGenSearchBot)|G|ICErsPRO|i(?:ki-bot|mbleCrawler|nja))|O(?:penfind|utfoxBot)|P(?:HP version tracker|ockey|ump)|QueryN.Metasearch|S(?:nake|paceBison|qworm)|URLy.Warning|Vacuum|Web(?:.Image.Collector|clipping\.com|masterWorldForumBot)|Zyborg)%",$useragent)) { $ax ++; $whyblockout .= 'Known bot user agent (OBB-30009). ';}
if(preg_match("%(?i)(?:\.getpebble\.com|silk-accelerated=true)$%",$useragent)) { $ax ++; $whyblockout .= 'Cloud accelerated agent (OBB-30010). ';}
if(preg_match('%(?i)nutch%',$useragent)) if(preg_match("%(?i)(?:google|bing|opera)bot%",$useragent)) { $ax ++; $whyblockout .= 'Nutch masquerading attempt discovered INSTA-BAN (OBB-30011). ';}
if(preg_match("%(?i)(?:<|>|â€™|\%0[AD0]|\%27|\%3[CE]|\%60|\d\/\*|#\!|\"|\n|^(?:.{0,9}|(?:\d+\.)?\d+)$)%",$useragent)) { $ax ++; $whyblockout .= 'Suspicious user agent detected (OBB-30012). ';}
$ax += inmatch($query,'obbtestobb','Test Trigger to test function (OBBTESTOBB). ');